<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Input Transaksi dan Export Excel</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h2 { color: purple; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #999; padding: 8px; text-align: left; }
  th { background-color: #f0f0f0; }
  .header-purple { background-color: #5A2A9A; color: white; font-weight: bold; text-align: center; }
  .header-green { background-color: #8DC63F; color: black; font-weight: bold; text-align: center; }
  input, button { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
  .input-group { max-width: 400px; margin-bottom: 15px; }
  button { width: auto; background-color: #5A2A9A; color: white; border: none; cursor: pointer; }
  button:hover { background-color: #3f1d6e; }
</style>
</head>
<body>

<h2>PT. AMANAH TERIMA GADAI - Bukti Pengeluaran Kas Kecil</h2>

<div class="input-group">
  <label for="keterangan">Keterangan:</label>
  <input type="text" id="keterangan" placeholder="Masukkan keterangan" />
</div>

<div class="input-group">
  <label for="tanggal">Tanggal:</label>
  <input type="date" id="tanggal" />
</div>

<div class="input-group">
  <label for="nilai">Nilai (Rp):</label>
  <input type="number" id="nilai" placeholder="Masukkan nilai transaksi" />
</div>

<button onclick="tambahData()">Tambah Data</button>

<table id="tabelData">
  <thead>
    <tr>
      <th>NO</th>
      <th>KETERANGAN</th>
      <th>TANGGAL</th>
      <th>NILAI</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button onclick="downloadExcel()">Download Excel</button>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script>
  let dataTransaksi = [];

  function tambahData() {
    const keterangan = document.getElementById('keterangan').value.trim();
    const tanggal = document.getElementById('tanggal').value;
    const nilai = document.getElementById('nilai').value;

    if (!keterangan || !tanggal || !nilai) {
      alert('Silakan isi semua data!');
      return;
    }

    dataTransaksi.push({
      keterangan,
      tanggal,
      nilai: parseInt(nilai),
    });

    renderTable();
    clearInput();
  }

  function clearInput() {
    document.getElementById('keterangan').value = '';
    document.getElementById('tanggal').value = '';
    document.getElementById('nilai').value = '';
  }

  function renderTable() {
    const tbody = document.querySelector('#tabelData tbody');
    tbody.innerHTML = '';

    dataTransaksi.forEach((item, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${item.keterangan}</td>
        <td>${item.tanggal}</td>
        <td>${item.nilai.toLocaleString('id-ID')}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function downloadExcel() {
    if (dataTransaksi.length === 0) {
      alert("Belum ada data transaksi!");
      return;
    }

    // Header bagian atas dengan array of array
    const ws_data = [];

    // Header info perusahaan (akan di-merge)
    ws_data.push([]); // Baris 1 kosong
    ws_data.push([]); // Baris 2 kosong
    ws_data.push(['PT. AMANAH TERIMA GADAI']); // Baris 3: PT name, akan di-merge A3:F3
    ws_data.push(['BUKTI PENGELUARAN KAS KECIL', '', '', '', 'JANUARI 2026']); // Baris 4: Judul, akan di-merge A4:E4, F4 terpisah
    ws_data.push(['NO', 'KETERANGAN', 'Tanggal', 'Nilai', 'Cash']); // Baris 5: Header tabel

    // Konversi data transaksi ke format baris excel
    dataTransaksi.forEach((item, index) => {
      ws_data.push([
        index + 1,
        item.keterangan,
        '',
        new Date(item.tanggal),   // pakai objek Date untuk "Tanggal"
        item.nilai,
        ''
      ]);
    });

    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet(ws_data);

    // Set lebar kolom agar auto fix sesuai contoh
    ws['!cols'] = [
      { wch: 5 },   // NO kecil
      { wch: 60 },  // KETERANGAN lebih lebar, sesuai contoh
      { wch: 5 },   // Kolom kosong kecil
      { wch: 15 },  // Tanggal, cukup untuk tanggal format
      { wch: 15 },  // Nilai, cukup untuk angka besar
      { wch: 10 }   // Cash, bisa disesuaikan
    ];

    // Merge cells untuk colspan
    ws['!merges'] = [
      { s: { r: 2, c: 0 }, e: { r: 2, c: 4 } }, // Merge A3:F3 untuk PT name
      { s: { r: 3, c: 0 }, e: { r: 3, c: 3 } }  // Merge A4:E4 untuk judul bukti
    ];

    // Styling untuk warna background dan teks
    // Header PT (A3, tapi merged jadi semua sel di range)
    const ptCell = ws['A3']; // Sel utama untuk merge
    if (ptCell) {
      ptCell.s = {
        fill: { fgColor: { rgb: "FF5A2A9A" } }, // Ungu background
        font: { color: { rgb: "FFFFFFFF" }, bold: true }, // Teks putih, bold
        alignment: { horizontal: "center", vertical: "center" }
      };
    }

    // Judul bukti (A4, merged)
    const titleCell = ws['A4'];
    if (titleCell) {
      titleCell.s = {
        fill: { fgColor: { rgb: "FF8DC63F" } }, // Hijau background
        font: { color: { rgb: "FF000000" }, bold: true }, // Teks hitam, bold
        alignment: { horizontal: "center", vertical: "center" }
      };
    }

    // Format kolom tanggal pada kolom D (index 3, mulai baris 6 karena data dari baris 7)
    const range = XLSX.utils.decode_range(ws['!ref']);
    for(let R = 5; R <= range.e.r; ++R){ // Data dari baris 6 (0-based = 5)
      let cell_address = {c:3, r:R};
      let cell_ref = XLSX.utils.encode_cell(cell_address);
      if(ws[cell_ref]) ws[cell_ref].z = XLSX.SSF.get_table()[14]; // Format tanggal "m/d/yy"
    }

    XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
    XLSX.writeFile(wb, 'Bukti_Pengeluaran_Kas_Kecil.xlsx');
  }
</script>

</body>
</html>
